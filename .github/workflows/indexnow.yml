name: Submit to IndexNow

on:
  workflow_dispatch:

jobs:
  submit:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸš€ æäº¤åˆ° IndexNow
        env:
          KEY: ${{ secrets.INDEXNOW_KEY }}
          LOCATION: ${{ secrets.INDEXNOW_KEY_LOCATION }}
        run: |
          echo "========================================"
          echo "        IndexNow æäº¤"
          echo "========================================"
          echo "æäº¤æ—¶é—´ï¼š$(date)"
          echo ""
          
          # æ˜¾ç¤ºé…ç½®ï¼ˆéšè—éƒ¨åˆ†å¯†é’¥ï¼‰
          echo "ğŸ“‹ é…ç½®ä¿¡æ¯ï¼š"
          echo "   ç½‘ç«™ï¼šwww.jfgadai.com"
          echo "   å¯†é’¥ï¼š${KEY:0:8}****ï¼ˆå‰8ä½ï¼‰"
          echo "   å¯†é’¥æ–‡ä»¶ï¼š$LOCATION"
          echo ""
          
          # éªŒè¯å¯†é’¥æ–‡ä»¶å¯è®¿é—®
          echo "ğŸ” éªŒè¯å¯†é’¥æ–‡ä»¶ï¼š"
          KEY_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "$LOCATION")
          if [ "$KEY_STATUS" = "200" ]; then
            echo "   âœ… å¯†é’¥æ–‡ä»¶å¯è®¿é—®ï¼ˆHTTP 200ï¼‰"
          else
            echo "   âŒ å¯†é’¥æ–‡ä»¶æ— æ³•è®¿é—®ï¼ˆHTTP $KEY_STATUSï¼‰"
            exit 1
          fi
          echo ""
          
          # æäº¤åˆ° IndexNow
          echo "ğŸ“¡ æäº¤åˆ° IndexNow API..."
          RESPONSE=$(curl -s -w "\nHTTPçŠ¶æ€ç ï¼š%{http_code}" \
            -X POST "https://api.indexnow.org/indexnow" \
            -H "Content-Type: application/json; charset=utf-8" \
            -d '{
              "host": "www.jfgadai.com",
              "key": "'"$KEY"'",
              "keyLocation": "'"$LOCATION"'",
              "urlList": [
                "https://www.jfgadai.com/"
              ]
            }')
          
          echo "æœåŠ¡å™¨å“åº”ï¼š"
          echo "$RESPONSE"
          echo ""
          
          # åˆ†æç»“æœ
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1 | grep -o '[0-9]*')
          
          echo "ğŸ“Š æäº¤ç»“æœï¼š"
          if [ "$HTTP_CODE" = "200" ] || [ "$HTTP_CODE" = "202" ]; then
            echo "   ğŸ‰ æˆåŠŸï¼IndexNow å·²æ¥å—æäº¤"
            echo "   æœç´¢å¼•æ“å°†åœ¨å‡ å°æ—¶å†…å¤„ç†"
          else
            echo "   âŒ æäº¤å¤±è´¥ï¼ˆHTTP $HTTP_CODEï¼‰"
            echo "   è¯·æ£€æŸ¥é…ç½®"
          fi
          
          echo ""
          echo "========================================"
